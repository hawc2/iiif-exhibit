{{ define "main" }}
<section class="hero">
  <div class="wrap">
    <p class="eyebrow">Browse</p>
    <h1>{{ .Title }}</h1>
    <div class="lead">{{ .Content }}</div>
  </div>
</section>

{{ $items := site.Data.posters.items }}

<section class="wrap">
  <div class="card-grid">
    {{ range .Pages }}
      {{ $subthemes := .Params.subthemes }}
      {{ $themeItems := slice }}
      {{ if $subthemes }}
        {{ range $subthemes }}
          {{ $sub := where $items "themes" "intersect" (slice .theme) }}
          {{ $themeItems = $themeItems | append $sub }}
        {{ end }}
      {{ else }}
        {{ $themeItems = where $items "themes" "intersect" (slice .Params.theme) }}
      {{ end }}
      {{ $first := index $themeItems 0 }}
      {{ $image := partial "iiif-image.html" $first }}
      <article class="card reveal">
        <a class="image-link" href="{{ .RelPermalink }}">
          <div class="image-frame">
            <img
              src="{{ $image }}"
              alt="{{ .Title }}"
              loading="lazy"
              decoding="async"
            />
          </div>
        </a>
        <div class="card-body">
          <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
          <p class="meta">{{ len $themeItems }} posters</p>
          <p class="summary">{{ .Params.description }}</p>
        </div>
      </article>
    {{ end }}
  </div>
</section>
{{ end }}
